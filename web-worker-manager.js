var Manager=(function(){var Job=function(a,b,c,d){"use strict";Object.defineProperty(this,"id",{value:a,enumerable:!0}),Object.defineProperty(this,"name",{value:b,enumerable:!0}),Object.defineProperty(this,"data",{value:c,enumerable:!0}),Object.defineProperty(this,"callback",{value:d,enumerable:!0}),Object.defineProperty(this,"time-created",{value:Date.now(),enumerable:!0})},FileWorker=function(a,b){"use strict";var c,d,e,f,g,h,i,j=this,k=function(a){return i?0:Date.now()-f>a},l=function(){h&&(h.terminate(),h=void 0,i=void 0)},m=function(){return h=new Worker(a),h.onmessage=function(a){f=Date.now();var b=JSON.parse(a.data);return b["time-completed"]=Date.now(),b["total-time"]=b["time-completed"]-b["time-created"],i.callback(b.error,b.data,b),i=void 0,d?d(j,b):void 0},h.onerror=function(a){return f=Date.now(),e?e(j,a):void 0},f=Date.now(),b||(g=setInterval(function(){k(5e3)&&(l(),clearInterval(g))},1e3)),d?d(j,void 0):void 0},n=function(a){return h||m(),!i&&a?(i=a,h.postMessage(JSON.stringify(i)),!0):!1};Object.defineProperty(this,"send",{value:n}),Object.defineProperty(this,"close",{value:l}),Object.defineProperty(this,"start",{value:m}),Object.defineProperty(this,"restart",{value:function(){l(),m()}}),Object.defineProperty(this,"id",{get:function(){return c},set:function(a){c=a}}),Object.defineProperty(this,"status",{get:function(){return i?"working":"ready"}}),Object.defineProperty(this,"task",{get:function(){return i}}),Object.defineProperty(this,"onready",{get:function(){return d},set:function(a){d="function"==typeof a?a:void 0}}),Object.defineProperty(this,"onerror",{get:function(){return e},set:function(a){e="function"==typeof a?a:void 0}})},Manager=function(a,b){"use strict";b="number"==typeof b?b:5;var c,d,e=[],f=[],g=[],h=function(){return d=void 0===d?0:d+1,d%=Number.MAX_VALUE},i=function(a,b,c){var d,i=h();return a&&b&&c&&(d=new Job(i,a,b,c),g.push(d)),f.length>0?e[f.shift()].send():i},j=function(a){var b;for(b=0;b<e.length;b+=1)if(e[b].task.id===a)return e[b].restart(),!0;for(b=0;b<g.length;b+=1)if(g[b].id===a)return g.splice(b,1),!0;return!1},k=function(){var a,d=function(a){0===g.length?f.push(a.id):a.send(g.shift())},h=function(a){throw a};for(a=0;b>a;a+=1)e[a]=new FileWorker(c),e[a].id=a,e[a].onready=d,e[a].onerror=h,f.push(e[a].id);for(;g.length>0&&f.length>0;)i()},l=function(a){var b,d=function(){var a={},b=function(b,c){a[b]=c};self.onmessage=function(b){var c=JSON.parse(b.data);c["time-started"]=Date.now();try{c.data=a[c.name].apply(a[c.name],c.data)}catch(d){c.data=void 0,c.error=d}c["time-finished"]=Date.now(),c["task-time"]=c["time-finished"]-c["time-started"],self.postMessage(JSON.stringify(c))},Object.defineProperty(this,"on",{value:b})};window.XMLHttpRequest&&(b=new XMLHttpRequest,b.onreadystatechange=function(){4===b.readyState&&200===b.status&&(c=URL.createObjectURL(new Blob(["var WorkerFile = "+d.toString()+"\n\n\nvar worker = new WorkerFile();\n\n\n"+b.responseText],{type:"text/javascript"})),k())},b.open("GET",a,!0),b.send())};l(a),Object.defineProperty(this,"send",{value:i}),Object.defineProperty(this,"clear",{value:j}),Object.defineProperty(this,"workers",{get:function(){return e.length}}),Object.defineProperty(this,"activeWorkers",{get:function(){return e.length-f.length}}),Object.defineProperty(this,"readyWorkers",{get:function(){return f.length}}),Object.defineProperty(this,"tasks",{get:function(){return g.length+e.length-f.length}})};return Manager}());
